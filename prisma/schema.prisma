generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Better Auth tables
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified Boolean   @default(false)
  name          String?
  image         String?

  // Study app specific
  currentStreak Int       @default(0)
  maxStreak     Int       @default(0)
  lastStudyDate DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  sessions         Session[]
  accounts         Account[]
  studyLogs        StudyLog[]
  pomodoroSessions PomodoroSession[]
  userBadges       UserBadge[]
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Account {
  id           String    @id @default(cuid())
  userId       String
  accountId    String
  providerId   String
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
}

// Application tables
model StudyLog {
  id              String   @id @default(cuid())
  userId          String
  studyDate       DateTime @db.Date
  content         String   @db.VarChar(3000)
  durationMinutes Int      @default(0)
  reflection      String?  @db.VarChar(1000)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  pomodoroSessions PomodoroSession[]

  @@index([userId, studyDate])
  @@index([userId, createdAt(sort: Desc)])
}

model PomodoroSession {
  id              String   @id @default(cuid())
  userId          String
  studyLogId      String?
  completedAt     DateTime @default(now())
  durationMinutes Int      @default(25)
  createdAt       DateTime @default(now())

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  studyLog StudyLog? @relation(fields: [studyLogId], references: [id], onDelete: SetNull)

  @@index([userId, completedAt(sort: Desc)])
  @@index([studyLogId])
}

model Badge {
  id          String   @id
  name        String   @unique
  description String
  iconUrl     String?
  category    String   @default("achievement")
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())

  userBadges UserBadge[]
}

model UserBadge {
  id       String   @id @default(cuid())
  userId   String
  badgeId  String
  earnedAt DateTime @default(now())

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  badge Badge @relation(fields: [badgeId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId])
}
