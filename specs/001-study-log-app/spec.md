# Feature Specification: 学習管理アプリ

**Feature Branch**: `001-study-log-app`
**Created**: 2026-01-15
**Status**: Draft
**Input**: User description: "学習管理アプリを作りたい。ログイン必要です。学習管理アプリでは、日々の学習記録をつけれるようにしたい。学習記録をpdfで出力して学習の記録を他人に提出できるようにする。学習記録に加えて、日々の学習支援ツールとしてポモドーロタイマーもつけて欲しい。ポモドーロの記録も学習記録に追加して欲しい。学習記録には日々工夫したことなども入れられるようにしたい。学習記録をxで投稿できるようにしたい。"

## Clarifications

### Session 2026-01-15

- Q: マジックリンクの有効期限はどのくらいにしますか？ → A: 15分（標準的、メール遅延を考慮）
- Q: ポモドーロ完了時に当日の学習記録がない場合どうするか？ → A: 自動で新しい学習記録を作成し、ポモドーロを紐づける
- Q: デザインスタイルは？ → A: Neobrutalism（太いボーダー、オフセットシャドウ、鮮やかな配色）
- Q: レイアウトパターンは？ → A: Bento Grid（異なるサイズのカードを組み合わせたダッシュボード）

## User Scenarios & Testing _(mandatory)_

### User Story 1 - ユーザー登録・ログイン (Priority: P1)

ユーザーは学習記録を保存・管理するためにアカウントを作成し、ログインできる。これにより自分の学習データに安全にアクセスし、複数デバイスから利用できるようになる。

**Why this priority**: 認証はすべての機能の前提条件であり、ユーザーの学習記録を保護するために必須。

**Independent Test**: アカウント作成とログイン・ログアウトのみで動作確認可能。ユーザーがログイン状態を維持できることを検証。

**Acceptance Scenarios**:

1. **Given** 未登録のユーザー, **When** メールアドレスを入力してマジックリンクを要求する, **Then** 認証用リンクがメールで送信される
2. **Given** マジックリンクを受信したユーザー, **When** リンクをクリックする, **Then** アカウントが作成（初回の場合）されダッシュボードにリダイレクトされる
3. **Given** 登録済みのユーザー, **When** メールアドレスを入力してマジックリンクを要求しリンクをクリックする, **Then** ダッシュボードにアクセスできる
4. **Given** ログイン済みのユーザー, **When** ログアウトを行う, **Then** セッションが終了しログイン画面に戻る
5. **Given** 未ログインのユーザー, **When** 保護されたページにアクセスしようとする, **Then** ログイン画面にリダイレクトされる

---

### User Story 2 - 学習記録の作成・編集 (Priority: P1)

ユーザーは日々の学習内容を記録として残すことができる。各記録には学習日時、学習内容、所要時間、工夫した点などを含めることができる。

**Why this priority**: 学習管理アプリの中核機能であり、他の機能（PDF出力、X投稿）の前提となる。

**Independent Test**: 学習記録の作成・編集・削除・一覧表示が単独で動作することを検証。

**Acceptance Scenarios**:

1. **Given** ログイン済みのユーザー, **When** 新しい学習記録を作成する, **Then** 記録が保存され一覧に表示される
2. **Given** 既存の学習記録がある, **When** 記録を編集する, **Then** 変更内容が保存される
3. **Given** 既存の学習記録がある, **When** 記録を削除する, **Then** 記録が一覧から削除される
4. **Given** 複数の学習記録がある, **When** 一覧を表示する, **Then** 日付順（新しい順）で表示される

---

### User Story 3 - ポモドーロタイマー (Priority: P2)

ユーザーはポモドーロテクニックを使って集中した学習を行える。タイマーで作業時間と休憩時間を管理し、完了したポモドーロセッションは自動的に学習記録に反映される。

**Why this priority**: 学習支援ツールとして重要だが、基本的な学習記録機能が先に必要。

**Independent Test**: タイマーの開始・一時停止・リセット機能と、完了時の記録生成を単独で検証可能。

**Acceptance Scenarios**:

1. **Given** ログイン済みのユーザー, **When** ポモドーロタイマーを開始する, **Then** 25分のカウントダウンが始まる
2. **Given** タイマーが動作中, **When** 一時停止ボタンを押す, **Then** タイマーが停止し残り時間が保持される
3. **Given** タイマーが動作中, **When** 25分が経過する, **Then** 通知が表示され休憩時間（5分）に切り替わる
4. **Given** ポモドーロセッションが完了した, **When** セッション終了時, **Then** 完了したポモドーロが当日の学習記録に自動追加される
5. **Given** ポモドーロセッションが完了し当日の学習記録がない, **When** セッション終了時, **Then** 新しい学習記録が自動作成されポモドーロが紐づけられる
6. **Given** タイマー画面, **When** リセットボタンを押す, **Then** タイマーが初期状態（25分）に戻る

---

### User Story 4 - 学習記録のPDF出力 (Priority: P2)

ユーザーは学習記録をPDFファイルとして出力し、学校や職場など第三者に提出できる。

**Why this priority**: 記録の外部共有は重要な機能だが、先に記録機能が必要。

**Independent Test**: 指定期間の学習記録をPDFとしてダウンロードできることを検証。

**Acceptance Scenarios**:

1. **Given** 学習記録が存在する, **When** PDF出力を実行する, **Then** 指定期間の記録を含むPDFがダウンロードされる
2. **Given** PDF出力画面, **When** 出力期間（開始日・終了日）を指定する, **Then** 指定期間内の記録のみがPDFに含まれる
3. **Given** PDFが生成された, **Then** PDFには学習日、学習内容、所要時間、ポモドーロ数、工夫した点が含まれる

---

### User Story 5 - ゲーミフィケーション（ストリーク・バッジ） (Priority: P2)

ユーザーは連続学習日数（ストリーク）やバッジを獲得することで、学習を続けるモチベーションを維持できる。ダッシュボードで自分の達成状況を確認できる。

**Why this priority**: 学習継続のモチベーション向上は学習アプリの重要な価値であり、基本的な記録機能と同時に提供すべき。

**Independent Test**: ストリークのカウントとバッジ獲得の判定が正しく動作することを単独で検証可能。

**Acceptance Scenarios**:

1. **Given** ログイン済みのユーザー, **When** ダッシュボードを表示する, **Then** 現在の連続学習日数（ストリーク）が表示される
2. **Given** 前日に学習記録がある, **When** 当日も学習記録を作成する, **Then** ストリークが1日増加する
3. **Given** 前日に学習記録がない, **When** 当日学習記録を作成する, **Then** ストリークが1にリセットされる
4. **Given** 特定の条件を達成した, **When** 条件達成時, **Then** 対応するバッジが獲得され通知が表示される
5. **Given** ログイン済みのユーザー, **When** バッジ一覧を表示する, **Then** 獲得済みバッジと未獲得バッジが確認できる
6. **Given** ダッシュボード, **Then** 累計学習時間、累計ポモドーロ数、総学習記録数が表示される

---

### User Story 6 - 学習記録のX（Twitter）投稿 (Priority: P3)

ユーザーは学習記録をXに投稿して、学習の成果を共有できる。

**Why this priority**: ソーシャル共有機能は付加価値であり、コア機能の後に実装。

**Independent Test**: 学習記録からX投稿画面を開き、投稿用テキストが生成されることを検証。

**Acceptance Scenarios**:

1. **Given** 学習記録が存在する, **When** X投稿ボタンを押す, **Then** 投稿用のテキストが生成されXの投稿画面が開く
2. **Given** X投稿画面, **Then** 投稿テキストには学習内容の要約と学習時間が含まれる
3. **Given** 日次の学習サマリー, **When** X投稿を実行する, **Then** 当日の合計学習時間とポモドーロ数を含む投稿ができる
4. **Given** バッジを獲得した, **When** X投稿を実行する, **Then** 獲得したバッジ情報を含む投稿ができる

---

### Edge Cases

- マジックリンクの有効期限（15分）が切れた場合はどうなるか？ → エラーメッセージを表示し、再度リンクを要求するよう案内する
- 同じメールアドレスで複数回マジックリンクを要求した場合はどうなるか？ → 最新のリンクのみが有効となり、古いリンクは無効化される
- 学習記録の入力が途中でブラウザを閉じた場合はどうなるか？ → 未保存の内容は失われ、保存済みの記録のみが残る
- ポモドーロタイマー中にブラウザを閉じた場合はどうなるか？ → タイマーの状態は失われ、完了していないセッションは記録されない
- 学習記録がない期間のPDF出力はどうなるか？ → 「該当期間の記録はありません」と表示されるPDFが生成される
- 非常に長い学習内容テキストを入力した場合はどうなるか？ → 入力文字数の上限（3000文字）を設け、超過分は入力を制限する
- X投稿のテキストが280文字を超える場合はどうなるか？ → 自動的に要約されるか、ユーザーが編集できる状態で投稿画面を開く
- 日付をまたいで深夜に学習記録をつけた場合のストリークはどうなるか？ → 記録の「学習日」に基づいてストリークを判定する（作成日時ではなく）
- 同じ日に複数の学習記録をつけた場合のストリークはどうなるか？ → 1日1回のカウントなので、同日の複数記録はストリーク1日分としてカウント
- 過去の日付で学習記録を追加した場合のストリークはどうなるか？ → 過去の記録追加でもストリークを再計算し、連続していれば反映される

## Requirements _(mandatory)_

### Functional Requirements

**認証**
- **FR-001**: System MUST ユーザーがメールアドレスを入力してマジックリンクを要求できる
- **FR-002**: System MUST マジックリンクをメールで送信できる（有効期限: 15分）
- **FR-002a**: System MUST マジックリンクをクリックしたユーザーを認証しログインさせる（初回の場合はアカウント作成も行う）
- **FR-002b**: System MUST 有効期限切れのマジックリンクを拒否しエラーメッセージを表示する
- **FR-003**: System MUST ユーザーがログアウトできる
- **FR-004**: System MUST 未認証ユーザーを保護されたページからログイン画面にリダイレクトする

**学習記録**
- **FR-005**: System MUST ユーザーが学習記録を作成できる（学習日、学習内容、所要時間、工夫した点を含む）
- **FR-006**: System MUST ユーザーが既存の学習記録を編集できる
- **FR-007**: System MUST ユーザーが学習記録を削除できる
- **FR-008**: System MUST 学習記録を日付順（新しい順）で一覧表示できる
- **FR-009**: System MUST 学習内容の入力を3000文字以内に制限する

**ポモドーロタイマー**
- **FR-010**: System MUST 25分の作業タイマーを提供する
- **FR-011**: System MUST 5分の休憩タイマーを提供する
- **FR-012**: System MUST タイマーの開始・一時停止・リセット機能を提供する
- **FR-013**: System MUST タイマー完了時に通知を表示する
- **FR-014**: System MUST 完了したポモドーロセッションを当日の学習記録に自動追加する（当日の記録がない場合は自動作成）

**PDF出力**
- **FR-015**: System MUST 学習記録をPDFファイルとして出力できる
- **FR-016**: System MUST PDF出力時に期間（開始日・終了日）を指定できる
- **FR-017**: System MUST PDFに学習日、学習内容、所要時間、ポモドーロ数、工夫した点を含める

**ゲーミフィケーション**
- **FR-018**: System MUST 連続学習日数（ストリーク）を計算・表示できる
- **FR-019**: System MUST 学習記録作成時にストリークを自動更新する
- **FR-020**: System MUST 累計学習時間、累計ポモドーロ数、総学習記録数をダッシュボードに表示する
- **FR-021**: System MUST 特定条件達成時にバッジを付与する
- **FR-022**: System MUST バッジ獲得時に通知を表示する
- **FR-023**: System MUST 獲得済みバッジと未獲得バッジの一覧を表示できる

**X投稿**
- **FR-024**: System MUST 学習記録からXの投稿画面を開ける
- **FR-025**: System MUST 投稿用テキストを自動生成する（学習内容要約、学習時間を含む）
- **FR-026**: System MUST 投稿テキストを280文字以内に収める（超過時は要約または編集可能）
- **FR-027**: System MUST バッジ獲得時にバッジ情報を含む投稿ができる

### Key Entities

- **User**: アプリケーションの利用者。メールアドレス、登録日、現在のストリーク日数、最長ストリーク日数を持つ（マジックリンク認証のためパスワードは不要）
- **StudyLog（学習記録）**: ユーザーの学習活動の記録。学習日、学習内容（テキスト）、所要時間（分）、工夫した点（テキスト）、作成日時、更新日時を持つ。Userに属する
- **PomodoroSession**: ポモドーロタイマーの完了セッション。完了日時、セッション時間（25分固定）を持つ。StudyLogに紐づく
- **Badge（バッジ）**: 達成可能なバッジの定義。バッジ名、説明、アイコン、獲得条件を持つ
- **UserBadge（獲得バッジ）**: ユーザーが獲得したバッジ。獲得日時を持つ。UserとBadgeに紐づく

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: ユーザーは2分以内にアカウント登録を完了できる
- **SC-002**: ユーザーは1分以内に学習記録を作成できる
- **SC-003**: ポモドーロタイマーの開始から完了まで、タイマー精度は±1秒以内である
- **SC-004**: PDF出力は30秒以内に完了する（100件の記録を含む場合）
- **SC-005**: X投稿画面は3秒以内に開く
- **SC-006**: 同時に100人のユーザーが利用してもパフォーマンス劣化なく動作する
- **SC-007**: 初めてのユーザーでも説明なしで主要機能（記録作成、タイマー使用）を使用できる
- **SC-008**: ユーザーの70%以上が7日以上のストリークを達成する（ゲーミフィケーションによる継続率向上）
- **SC-009**: バッジ獲得通知は記録作成から1秒以内に表示される

## Assumptions

- 認証方式はマジックリンク方式を採用（パスワード不要、メールで送信されるワンタイムリンクでログイン）
- ポモドーロタイマーの作業時間は25分、休憩時間は5分で固定（カスタマイズは初期スコープ外）
- X投稿はXの公式Web Intent機能を利用（API連携は初期スコープ外）
- PDFのデザインはシンプルな一覧形式（カスタムテンプレートは初期スコープ外）
- モバイル対応はレスポンシブデザインで対応（ネイティブアプリは初期スコープ外）
- データ保持期間は無期限（ユーザーが削除するまで）
- バッジは初期セットとして以下を用意（カスタムバッジ作成は初期スコープ外）:
  - 初めての学習記録（1件目の記録作成）
  - 3日連続学習（ストリーク3日達成）
  - 7日連続学習（ストリーク7日達成）
  - 30日連続学習（ストリーク30日達成）
  - ポモドーロマスター（累計100ポモドーロ達成）
  - 学習の達人（累計学習時間100時間達成）

## Design System

### デザインスタイル: Neobrutalism

大胆で遊び心のあるNeobrutalism（ネオブルータリズム）スタイルを採用する。

**特徴**:
- **太いボーダー**: 2-4pxの黒のアウトライン
- **オフセットシャドウ**: 4-8pxオフセットの硬い影（ぼかしなし）
- **鮮やかな配色**: 高彩度のアクセントカラー（黄、ピンク、青、緑など）
- **大胆なタイポグラフィ**: 太字のヘッドライン、読みやすい本文
- **角丸なし〜最小限**: 0-4pxの角丸（シャープな印象）

**カラーパレット例**:
| 用途 | 色 |
|------|-----|
| Background | #FFFEF0（クリーム） |
| Primary | #FF6B6B（コーラル） |
| Secondary | #4ECDC4（ティール） |
| Accent | #FFE66D（イエロー） |
| Border | #000000（ブラック） |
| Text | #1A1A1A（ダークグレー） |

### レイアウト: Bento Grid

ダッシュボードはBento Grid（弁当箱グリッド）レイアウトを採用。異なるサイズのカードを組み合わせて情報を整理する。

**グリッド構成**:
```
┌─────────────────┬───────────┐
│                 │           │
│   ストリーク    │  タイマー │
│   (2x2)        │  (1x2)    │
├────────┬────────┼───────────┤
│ 累計   │ 累計   │           │
│ 学習   │ ポモ   │  最近の   │
│ (1x1)  │ (1x1)  │  バッジ   │
├────────┴────────┤  (1x2)    │
│    今日の学習    │           │
│    (2x1)        │           │
└─────────────────┴───────────┘
```

**カードサイズ**:
- XS: 1x1（統計数値）
- SM: 1x2（縦長情報）
- MD: 2x1（横長コンテンツ）
- LG: 2x2（メイン情報）

**インタラクション**:
- ホバー時: 影が大きくなる（4px → 8px）
- クリック時: 影が小さくなる（押し込み効果）
